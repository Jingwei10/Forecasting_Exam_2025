---
title: "Arbejdsløshed - Ugeeksamen i Forecasting"
author: 
- name: "Christine Hegelund"
- name: "Jing Wei"
- name: "Marcus Nielsen"
date: "2025-06-13"
format: 
  pdf: 
    documentclass: article
    toc-depth: 3
    number-sections: true
    titlepage: true
    keep-tex: true
    fig-cap-location: top
editor: visual
lang: da
---

```{r Pakker}
#| echo: false
#| warning: false
#| message: false

pacman::p_load(tidyverse, gghighlight, hrbrthemes, tsibble, lubridate, 
               ggplot2, feasts, fable, tsibbledata, forecast, fpp2, fpp3,
               fabletools, knitr, ggpubr, gridExtra, GGally, slider,
               forecast, car, shiny, glue, broom, kableExtra, gt, seasonal, 
               latex2exp, ggfortify, janitor, readxl, rlang, dplyr, kableExtra)

```

\maketitle
\thispagestyle{empty}
\begin{center}
\large{Forecasting Eksamen} \\[3em]
\end{center}
\begin{center}
\includegraphics[width=0.9\textwidth]{fotos/forside.png} \\[2em]
\end{center}
\begin{center}
\fcolorbox{gray}{white}{
\parbox{0.8\textwidth}{
\centering
\textbf{Antal tegn (inkl. mellemrum): 97023}
}}
\end{center}
\begin{center}
\textbf{Vejledere:} \\
Bjarne Taulo Sørensen \\
\end{center}

\newpage

\addtocontents{toc}{\protect\setcounter{tocdepth}{-1}}

# Tabel over figurer {.unnumbered}

\thispagestyle{empty}

\newpage

\pagenumbering{arabic}
\setcounter{page}{1}
\tableofcontents
\newpage

# Introduktion

Arbejdsløshedstal er en central indikator for et lands økonomiske tilstand og udvikling. De påvirker både den enkelte borger og den nationale økonomi og indgår som en væsentlig faktor i politiske og økonomiske beslutningsprocesser. I takt med øget datatilgængelighed og forbedrede statistiske værktøjer er det blevet muligt at analysere og forudsige sådanne udviklingstræk med større præcision.

Denne opgave har til formål at modellere og forudsige udviklingen i arbejdsløsheden i Danmark, fordelt på køn og region, med afsæt i månedlige data for perioden januar 2007 til december 2019. Datasættet består af ti tidsserier – én for hver kombination af fem regioner og to køn – hvilket muliggør en detaljeret og differentieret analyse af både strukturelle og sæsonbetingede mønstre i ledigheden.

Metodisk anvender analysen klassiske teknikker til tidsserieanalyse med særligt fokus på modellerne ARIMA, ETS og en simpel benchmarkmodel (Seasonal Naive). For hver serie estimeres de tre modeltyper, og deres performance evalueres ved hjælp af forecast-metrikker som RMSE og MAPE. Derudover inddrages elementer som STL-dekomposition, transformation af data (log og Box-Cox), residualanalyse og test for hvid støj (Ljung-Box).

Formålet er ikke blot at fremskrive arbejdsløsheden for året 2020, men også at vurdere styrker og begrænsninger ved klassiske modeller til tidsserieanalyse. Med dette udgangspunkt opstår spørgsmålet, hvordan sådanne modeller bedst kan anvendes til at analysere og forudsige arbejdsløsheden i Danmark, fordelt på region og køn.

# Problemformulering

Hvordan kan klassiske tidsseriemodeller anvendes til at analysere og forudsige udviklingen i arbejdsløsheden i Danmark, fordelt på region og køn?

For at besvare dette spørgsmål undersøges følgende delspørgsmål:

1.  Hvordan varierer arbejdsløshedens udvikling og sæsonmønstre på tværs af regioner og køn, og hvordan kan disse identificeres gennem eksplorativ dataanalyse og dekomposition?

2.  Hvordan performer modellerne ARIMA, ETS og Seasonal Naive i forhold til hinanden, når det gælder præcision, residualstruktur og prognoseegenskaber?

3.  Hvilke modeller er bedst egnede til at fremskrive arbejdsløshedstallene for 2020, og hvordan varierer resultater og usikkerhed på tværs af serierne?

## Afgrænsning

Analysen er udelukkende baseret på de udleverede data og har fokus på metodisk klarhed, reproducerbarhed og faglig konsistens. Eksterne forklarende faktorer som COVID-19, konjunkturændringer og politiske tiltag inddrages ikke.

Formålet er ikke at give strategiske eller forretningsmæssige anbefalinger, men at demonstrere korrekt og velbegrundet anvendelse af klassiske forecasting-metoder. Der lægges vægt på modellering, evaluering og sammenligning af tidsseriemodeller i en struktureret analytisk ramme.

### Anvendelse af AI-værktøj

I udarbejdelsen af denne opgave er ChatGPT (GPT-4o) anvendt som et støtteværktøj. Værktøjet har primært været anvendt til idéudvikling, sproglig sparring, forbedring af formuleringers klarhed, grammatisk gennemgang samt støtte ved udformning af enkelte kodestumper. Anvendelsen har udelukkende omfattet sproglige, strukturelle og tekniske elementer. Alt analytisk, fortolkende og konkluderende indhold er selvstændigt udarbejdet af gruppens medlemmer.

## Definitioner/forkortelser

I dette afsnit afklares centrale begreber og forkortelser, der anvendes gennem opgaven, for at sikre en ensartet forståelse.

-   **ARIMA**: AutoRegressive Integrated Moving Average – klassisk tidsseriemodel med trend og autokorrelation\
-   **ETS**: Exponential Smoothing State Space Model – glatningsbaseret model til tidsserier med trend og sæson\
-   **SNAÏVE**: Seasonal Naive – benchmarkmodel, hvor forecast er lig med seneste sæsonværdi\
-   **RMSE**: Root Mean Squared Error – fejlmål hvor store afvigelser vægtes højt\
-   **MAPE**: Mean Absolute Percentage Error – fejl angivet i procent\
-   **STL**: Seasonal-Trend decomposition using Loess – metode til dekomponering af tidsserier\
-   **CV**: Cross-validation – validering af modeller via rullende trænings-/testvinduer\
-   **Ljung-Box**: Test for autokorrelation i modelresidualer (white noise)

## Struktur

Opgaven er struktureret i overensstemmelse med en klassisk tilgang til analyse af tidsserier og følger fire hovedfaser.

Først gennemføres en eksplorativ dataanalyse (EDA), hvor serierne visualiseres og undersøges for tendenser og sæsonmønstre. Dette sker ved hjælp af grafer, deskriptive statistikker og STL-dekomposition. Data transformeres ved behov. Dernæst estimeres tre modeltyper for hver serie: ARIMA, ETS og Seasonal Naive. Disse modeller valideres gennem krydsvalidering og residualanalyse. På baggrund af modelperformance foretages fremskrivninger af arbejdsløsheden for 2020 med tilhørende prædiktionsintervaller. Afslutningsvis sammenlignes modellerne og arbejdsløshedsniveauerne på tværs af regioner og køn, og der konkluderes på analysens hovedspørgsmål.

# Data og forberedelse

Analysen er baseret på et datasæt med månedlige arbejdsløshedstal i Danmark fra januar 2007 til december 2019. Data er opdelt på køn (mænd og kvinder) og region (de fem danske regioner), hvilket resulterer i ti separate tidsserier.

Datasættet er udleveret i forbehandlet format som en tsibble med korrekt angivne indeks- og nøglevariabler.

```{r}
# Indlæs datasættet
data <- read_rds("data/Airidk_long.rds")
```

# Eksplorativ dataanalyse (EDA)

Dette afsnit har til formål at skabe et overblik over datasættets struktur og variation forud for modelvalget. Gennem visualiseringer, deskriptive statistikker og dekomponering undersøges arbejdsløshedens udvikling på tværs af regioner og køn fra 2007 til 2019. Analysen afdækker tendenser, sæsonmønstre og forskelle i niveau og variation. STL-dekomposition anvendes til at isolere trend, sæson og residualer, mens datatransformation vurderes for at sikre modellérbarhed. Resultaterne danner det metodiske grundlag for den efterfølgende modellering.

## Visualisering af udvikling og mønstre

Formålet med dette afsnit er at identificere centrale mønstre og karakteristika i arbejdsløshedsdataene – herunder trends, sæsonvariationer, regionale forskelle og forskelle mellem køn. Visualiseringerne danner grundlag for valg af passende modeller til hver tidsserie.

### Udvikling over tid

I de følgende figurer undersøges udviklingen i arbejdsløsheden over tid. Til at begynde med anvendes den oprindelige skala for at give et lettilgængeligt overblik (Figur 1 og 2). Fra Figur 3 og frem benyttes en log-transformation for at stabilisere variationen i serierne, især blandt mænd, og for at sikre sammenlignelighed i videre modellering og forecast.

**Figur 1: Udvikling i kvinders arbejdsløshed pr. region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 1

data |> 
  filter(kon == "Kvinder") |> 
  autoplot(svalue) +
  labs(
    title = "Figur 1: Udvikling i kvinders arbejdsløshed pr. region",
    x = "Tid", y = "Arbejdsløse pr. 10.000 personer"
  ) +
  theme(legend.title = element_blank())
```

Figuren viser den månedlige arbejdsløshed blandt kvinder i de fem danske regioner fra 2007 til 2019. Der fremgår et tydeligt sæsonmønster med højere ledighed i vintermånederne og lavere i sommerperioden. Niveauet varierer regionalt, hvor Region Hovedstaden typisk ligger højest og Nordjylland lavest. Samlet ses en faldende tendens efter finanskrisen.

**Figur 2: Udvikling i mænds arbejdsløshed pr. region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 2

data |> 
  filter(kon == "Mænd") |> 
  autoplot(svalue) +
  labs(
    title = "Figur 2",
    subtitle = "Udvikling i mænds arbejdsløshed pr. region",
    x = "Tid",
    y = "Arbejdsløse pr. 10.000 personer"
  ) +
  theme(
    legend.title = element_blank()
  )

```

Sammenlignet med kvinder ses større udsving og et generelt højere niveau i mænds arbejdsløshed. Sæsonmønstrene er mere markante, og variationen mellem regionerne er tydeligere – især i Region Syddanmark og Midtjylland, hvor krisen i 2008-2009 medfører et kraftigt midlertidigt løft i ledigheden.

**Figur 3: Udvikling i arbejdsløshed hos pr. region og køn (log-skala)**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 3

data_long <- data |> 
  mutate(
    original = svalue,
    log_value = log(svalue)
  ) |> 
  pivot_longer(
    cols = c(original, log_value),
    names_to = "type",
    values_to = "value"
  )
ggplot(data_long, aes(x = yearmonth, y = value, color = kon, linetype = type)) +
  geom_line(size = 0.8) +
  facet_wrap(~ region) +
  scale_color_manual(
    values = c("Mænd" = "steelblue", "Kvinder" = "hotpink")
  ) +
  scale_linetype_manual(
    values = c("original" = "dashed", "log_value" = "solid"),
    labels = c("original" = "Original skala", "log_value" = "Log-skala")
  ) +
  labs(
    title = "Sammenligning af original og log-skala",
    subtitle = "Log jævner variationerne i arbejdsløshedsdata",
    x = "Tid", y = "Værdi (arbejdsløse pr. 10.000)",
    color = "Køn",
    linetype = "Skala"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    plot.title = element_text(face = "bold"),
    strip.text = element_text(face = "bold")
  )

```

Figur 3 viser, hvordan arbejdsløsheden har udviklet sig for mænd og kvinder i de fem danske regioner – både på original og log-transformeret skala.\
De stiplede linjer repræsenterer de oprindelige værdier, mens de fuldt optrukne linjer viser samme udvikling på log-skala. Log-transformationen gør det nemmere at få øje på mønstre og forskelle, især i serier med store udsving eller høj varians. Hvor den oprindelige skala fremhæver de absolutte niveauer, giver log-skalaen et mere balanceret overblik over den relative udvikling. Den log-transformerede fremstilling danner derfor grundlag for den videre analyse.

### Sæsonmønstre

Med log-transformerede data som fundament undersøges nu sæsonmønstrene i arbejdsløsheden nærmere. Gennem sæsonplots og subserieplots vurderes, hvordan arbejdsløsheden typisk varierer over året – og hvordan dette adskiller sig mellem mænd og kvinder samt på tværs af regioner.

**Figur 4: Sæsonmønster for mænd pr. region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 4: Sæsonmønster for mænd pr. region

data |> 
  filter(kon == "Mænd") |> 
  gg_season(log(svalue)) +
  labs(
    title = "Figur 4",
    subtitle = "Sæsonmønster for mænd pr. region (log-skala)",
    x = "Måned",
    y = "Log(Arbejdsløshed)"
  )
```

Figur 4 viser sæsonmønstre i mænds arbejdsløshed fordelt på regioner. Hver farvet linje repræsenterer et år, og linjernes forløb illustrerer, hvordan arbejdsløsheden typisk er højest i årets begyndelse (januar–marts) og lavest i sommermånederne (juni–august). Mønsteret er relativt konsistent på tværs af år og regioner, hvilket understøtter tilstedeværelsen af en stabil sæsonkomponent i mænds ledighed. De højeste niveauer ses i Region Hovedstaden, mens Region Sjælland og Region Nordjylland ligger lavere. Bemærk især det markante fald fra marts til juni, som gentager sig på tværs af årstal.

**Figur 5: Sæsonmønster for kvinder pr. region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 5

data |> 
  filter(kon == "Kvinder") |> 
  gg_season(log(svalue)) +
  labs(
    title = "Figur 5",
    subtitle = "Sæsonmønster for kvinder pr. region (log-skala)",
    x = "Måned",
    y = "Log(Arbejdsløshed)"
  )
```

Sammenlignet med mænd er sæsonudsvingene blandt kvinder mindre udtalte, og udviklingen fremstår mere jævn og stabil på tværs af årene. Niveauforskellene mellem regionerne er bevaret, men udsvingene over måneder er mere afdæmpede. Det indikerer en lavere volatilitet i kvinders arbejdsløshed og en mere ensartet sæsonprofil.

**Figur 6: Subserieplot for mænd pr. måned og region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 6

data |> 
  filter(kon == "Mænd") |> 
  gg_subseries(log(svalue)) +
  labs(
    title = "Figur 6",
    subtitle = "Subserieplot for mænd pr. måned og region (log-skala)",
    x = "Måned",
    y = "Log(Arbejdsløshed)"
  )
```

Figur 6 viser udviklingen i mænds arbejdsløshed fordelt på måneder og regioner, hvor hver facetteret celle repræsenterer en måned. Den sorte linje viser udviklingen over tid, mens den blå streg repræsenterer gennemsnittet. Det ses, at arbejdsløsheden konsekvent topper i årets første måneder og falder hen over sommeren. Desuden er udsvingene mellem år særligt store i vinterhalvåret, hvilket understreger en høj sæsonafhængighed og volatilitet i mænds ledighedsniveau. Mønstret er gennemgående i alle regioner, om end niveauet varierer.

**Figur 7: Subserieplot for kvinder pr. måned og region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 7
data |> 
  filter(kon == "Kvinder") |> 
  gg_subseries(log(svalue)) +
  labs(
    title = "Figur 7",
    subtitle = "Subserieplot for kvinder pr. måned og region (log-skala)",
    x = "Måned",
    y = "Arbejdsløshed"
  )
```

Sammenlignet med mænd viser kvinder tilsvarende sæsonmønstre med højere ledighed i årets begyndelse og lavere i sommermånederne. Udsvingene er dog mindre markante, og variationen mellem år er mindre tydelig. Mønstret fremstår mere stabilt og jævnt fordelt på tværs af regioner, hvilket tyder på lavere volatilitet i kvindernes arbejdsløshed.

Udover sæsonmæssige udsving varierer arbejdsløsheden betydeligt på tværs af både geografi og køn. Dette undersøges nærmere i de følgende visualiseringer.

### Regionale og kønsmæssige forskelle

I dette afsnit rettes fokus mod samspillet mellem køn og region. Der undersøges, hvordan forskelle i arbejdsløshedsniveau og -mønstre varierer både mellem regioner og mellem mænd og kvinder. Visualiseringerne præsenteres i forskellige facetteringer for at fremhæve de vigtigste forskelle.

**Figur 8: Arbejdsløshed fordelt på regioner – opdelt efter køn**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 8

data |> 
  autoplot(log(svalue))  +
  aes(colour = region) +
  facet_wrap(~ kon) +
  labs(
    title = "Figur 8",
    subtitle = "Arbejdsløshed fordelt på regioner – opdelt efter køn (log-skala)",
    y = "Log(Arbejdsløse pr. 10.000 personer)", x = "Tid"
  ) +
  theme(legend.position = "bottom", legend.title = element_blank())

```

Figur 8 viser den log-transformerede udvikling i arbejdsløsheden blandt mænd og kvinder, fordelt på regioner. Hver farve repræsenterer en region, og mænd og kvinder vises i hver sin fane, så det er lettere at sammenligne på tværs. Log-skalaen gør forskellene mellem regionerne mere overskuelige og dæmper de største udsving. Niveauet er stadig højest i Region Hovedstaden og lavest i Nordjylland. Der er tydelige sæsonbevægelser, særligt blandt mænd, hvor udsvingene fortsat er størst. For kvinder fremstår udviklingen mere jævn.

**Figur 9: Arbejdsløshed fordelt på køn – opdelt efter region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 9

data |> 
  autoplot(log(svalue)) +
  aes(colour = kon, group = kon) +
  facet_wrap(~ region, scales = "free_y") +
  labs(
    title = "Figur 9",
    subtitle = "Arbejdsløshed fordelt på køn – opdelt efter region (log-skala)",
    y = "Log(Arbejdsløse pr. 10.000 personer)", x = "Tid",
    colour = "Køn"
  ) +
  scale_colour_manual(
    values = c("Mænd" = "steelblue", "Kvinder" = "hotpink")
  ) +
  theme(legend.position = "bottom", legend.title = element_blank())
```

Hvor Figur 8 fokuserede på at sammenligne regioner inden for hvert køn, giver Figur 9 et omvendt perspektiv: her sammenlignes køn i hver af de fem danske regioner. Mænd har generelt højere arbejdsløshed og mere markante udsving end kvinder – særligt i perioden omkring finanskrisen. Forskellene mellem kønnene er forholdsvis stabile på tværs af regioner, men mønstret bekræfter, at mænds ledighed både topper højere og varierer mere over tid. Kvindernes ledighed er lavere og udvikler sig mere glidende. Figuren understøtter dermed beslutningen om at analysere serierne individuelt. Samlet set viser figurerne, at arbejdsløsheden varierer tydeligt mellem både regioner og køn, hvilket bekræfter relevansen af at behandle hver tidsserie separat i den videre analyse. Som næste skridt suppleres med deskriptive statistikker, der opsummerer forskelle i niveau og udsving.

<!-- ### 1. Årlig sæsonrytme -->

<!-- **Hvad ser vi?**\ -->

<!-- Hver kurve går op om vinteren og ned om sommeren. -->

<!-- **Forestilling:** Tænk på et legetøjsfirma, der sender ekstra vikarer hjem i sommerferien – arbejdsløsheden falder, fordi der er flere sæsonansatte. Omvendt i vintermånederne, når der er færre byggeprojekter og udenlandsk turisme, stiger ledigheden. -->

<!-- -   **Eksempel:** I Region Midtjylland ser vi i januar cirka 2,2 ledige pr. 10 000, men i juli falder det til under 1,0. Det gentager sig hvert år. -->

<!-- ### 2. Mænd versus kvinder (kønsgabet) -->

<!-- **Hvad ser vi?\ -->

<!-- **Blå linjer (mænd) ligger næsten altid et lille nøk over pink (kvinder), og deres udsving er større. -->

<!-- **Forestilling:** Mænd har ofte flere midlertidige “svingdørs-ansættelser” (tænk vikar i byggebranchen), så når økonomien hænger i bremsen, bliver de fyret først – og når det går fremad, kommer de også lidt hurtigere tilbage i job, hvilket giver større “bumps” i kurven. -->

<!-- -   **Eksempel:** I 2010 ser vi en top på omkring 3,1 for mænd i Hovedstaden, mens kvinder når knap 2,6 – altså et klart løft for mænd. -->

<!-- ### 3. Finanskrise-effekten (2008–2012) -->

<!-- **Hvad ser vi?**\ -->

<!-- En kraftig pendlende stigning i alle regioner omkring 2009–2012. Efter 2013 begynder alle linjer at falde i roligt tempo. -->

<!-- **Forestilling:** Forestil dig en rutchebane: Først går kurven brat op (krise), så ned (genopretning), men alle “sidder i samme tog”, bare med forskellig højde på stigningen. -->

<!-- -   **Eksempel:** Region Syddanmark går fra et lavpunkt på \~0,8 (før krisen) op til 2,3, og falder derefter jævnt til omkring 1,0 i 2019. -->

<!-- ### 4. Regionale forskelle i niveau -->

<!-- **Hvad ser vi?**\ -->

<!-- Nogle regioner ligger højt, andre lavt: -->

<!-- -   **Hovedstaden** topper højest (\~3,2 i krise). -->

<!-- -   **Nordjylland** ligger lavest (under 1,3 som højeste i krise). -->

<!-- **Forestilling:** Tænk på by versus land: I storbyen (Hovedstaden) er konkurrencen om job større, og flere brancher rammes hårdt i krisetider, mens små samfund i Nordjylland ofte har mere stabile, lokale arbejdspladser. -->

<!-- -   **Eksempel:** I Nordjylland når mænds ledighed i krisen kun op på \~1,3, mod 3,1 i Hovedstaden. -->

<!-- ### 5. Volatilitet (støj i dataen) -->

<!-- **Hvad ser vi?**\ -->

<!-- Mænds kurver “hopper” mere fra måned til måned end kvinders. Kvindernes kurver er glattere. -->

<!-- **Forestilling:** Forestil dig to venner, der spiller på aktiemarkedet: Manden tager nogle hurtige køb og salg (“day trading”), mens kvinden køber for at holde længe (“investering”). Førstnævnte giver store udsving, sidstnævnte en mere stabil udvikling. -->

<!-- -   **Eksempel:** Mænd i Region Sjælland har store bump vinter/sommer, mens kvinders ledighed svæver mere jævnt. -->

<!-- ## Hvad betyder det for modellerne? -->

<!-- 1.  **Altid med sæson**\ -->

<!--     – Vælg en model, der kan håndtere den årlige op-og-ned-bevægelse, fx SARIMA eller ETS med sæson. -->

<!-- 2.  **Individuel tilpasning**\ -->

<!--     – Fordi hver region og hvert køn har forskellig “højde” og “bumps”, lader vi fable finde den helt rette model for **hver** af de 10 serier. Det sikrer, at modellen fanger lige netop de mønstre og støjniveauer, der gælder for den serie. -->

<!-- 3.  **Trendændring efter 2013**\ -->

<!--     – Vær opmærksom på, at der er en tydelig knæk omkring 2013. Overvej modeller (eller STL-dekomponering), som kan håndtere en let ændret trend dér. -->

## Deskriptive statistikker

For at supplere graferne anvendes deskriptive statistikker som gennemsnit, spredning, minimum og maksimum. De opsummerer niveau og variation i arbejdsløsheden pr. region og køn (Hyndman & Athanasopoulos, 2021). Statistikkerne giver et hurtigt overblik over forskelle mellem grupper og hjælper med at identificere serier med høj volatilitet. Det bidrager til at vurdere, hvor der kan være behov for særlig opmærksomhed i den videre modellering.

```{r tabel 1}
#| echo: false
#| warning: false
#| message: false

# Beregning
deskriptiv <- data |> 
  as_tibble() |>
  group_by(region, kon) |> 
  summarise(
    Gennemsnit = mean(svalue, na.rm = TRUE),
    `Standardafvigelse` = sd(svalue, na.rm = TRUE),
    Minimum = min(svalue, na.rm = TRUE),
    Maksimum = max(svalue, na.rm = TRUE),
    .groups = "drop"
  )

# Visning
deskriptiv |> 
  kable(format = "markdown", digits = 2, caption = "Tabel 1: Deskriptiv statistik per region og køn") |> 
  kable_styling(full_width = FALSE, position = "center", bootstrap_options = c("striped", "hover")) |> 
  row_spec(0, bold = TRUE, background = "#f0f0f0")

```

Tabel 1 opsummerer arbejdsløsheden på tværs af regioner og køn. Gennemsnittet viser det generelle niveau, mens standardafvigelsen giver et mål for variation over tid. Mænd har generelt højere gennemsnit og større udsving end kvinder, særligt i Region Hovedstaden og Syddanmark. Omvendt ses lavere og mere stabile niveauer i Nordjylland, især blandt kvinder. Minimums- og maksimumværdier understøtter indtrykket af høj volatilitet i visse serier – hvilket kan få betydning for modelvalget i næste fase.

## STL-dekomposition

For at opnå en bedre forståelse af de strukturelle komponenter i arbejdsløshedsserierne anvendes STL-dekomposition (Seasonal-Trend decomposition using Loess). Metoden adskiller tidsserier i tre komponenter: trend, sæson og remainder (Hyndman & Athanasopoulos, 2021). Det giver indblik i, hvor meget af variationen der kan forklares af langsigtede bevægelser, gentagne sæsonmønstre eller kortsigtede, uregelmæssige udsving.

Da særligt mændenes serier udviser høje niveauer og større variation, er alle serier log-transformeret forud for dekompositionen. Denne transformation stabiliserer variansen og gør det lettere at sammenligne komponenterne på tværs af regioner og køn.

STL anvendes her på de log-transformerede serier for henholdsvis kvinder og mænd i hver region. Resultaterne præsenteres i figur 10 og 11.

**Figur 10: STL-dekomposition for kvinder – log-transformeret arbejdsløshed pr. region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 10

kvinder_STL <- data |> 
  filter(kon == "Kvinder") |> 
  model(STL = STL(log(svalue), robust = TRUE))

kvinder_STL |> 
  components() |> 
  autoplot() +
  labs(
    title = "Figur 10: STL-dekomposition for kvinder",
    subtitle = "Log-transformeret arbejdsløshed pr. region",
    x = "Tid",
    y = "Log(arbejdsløshed)"
  )
```

Figur 10 viser STL-dekompositionen for kvinder i de fem danske regioner. Der ses tydelige sæsonmønstre med tilbagevendende lavpunkter i sommermånederne og højere ledighed i vinterhalvåret. Trends varierer mellem regionerne: Region Hovedstaden udviser generelt højere ledighed, mens Nordjylland og Sjælland ligger lavere. Residualerne ligger stabilt omkring nul, hvilket indikerer, at modellen formår at fange de dominerende strukturer i data.

**Figur 11: STL-dekomposition for mænd – log-transformeret arbejdsløshed pr. region**

```{r}
#| echo: false
#| warning: false
#| message: false

# Figur 11

mænd_STL <- data |> 
  filter(kon == "Mænd") |>
  model(STL = STL(log(svalue), robust = TRUE))

mænd_STL |> 
  components() |> 
  autoplot() +
  labs(
    title = "Figur 11: STL-dekomposition for mænd",
    subtitle = "Log-transformeret arbejdsløshed pr. region",
    x = "Tid",
    y = "Log(arbejdsløshed)"
  )
```

Figur 11 viser tilsvarende dekomposition for mænd. Her ses en tilsvarende stærk sæsonkomponent, men med mere markante udsving og højere ledighedsniveauer – især efter finanskrisen. Trends følger samme overordnede forløb som for kvinder, men afvigelserne er større. Dette bekræfter tidligere observationer om højere volatilitet i mænds ledighed. Residualkomponenten er mere varierende, hvilket kan indikere, at nogle udsving ikke fanges fuldt ud af modellen.

Disse observationer fra STL-dekompositionen bekræfter, at både trend og sæsonmønstre varierer betydeligt på tværs af serierne. Det understreger behovet for modeller, der kan tilpasses hver series struktur, hvilket vil blive præsenteret i det følgende afsnit.

# Modelvalg

I dette afsnit estimeres og sammenlignes tre klassiske modeltyper, ARIMA, ETS og benchmarkmodellen SNaive, for hver tidsserie (region × køn). Hver modeltype har forskellige antagelser og fordele og kan fange forskellige karakteristika i data, såsom trend, sæson og autokorrelation. Modelvalget foretages automatisk for hver serie via fable-pakken, og resultaterne anvendes i den efterfølgende validering og forecast.

## Valgte modeltyper

**ARIMA (AutoRegressive Integrated Moving Average)**\
ARIMA-modeller anvendes til at modellere tidsserier med autokorrelation og ikke-stationaritet. De kombinerer autoregressive (AR) led, differens (I) for at opnå stationaritet, og glidende gennemsnit (MA) led til at modellere fejl. Ved at inkludere sæsonkomponenter (SARIMA) kan modellen håndtere årligt gentagende mønstre. ARIMA er særligt velegnet til serier med langsigtede trends og strukturelle skift, hvor tidligere værdier har stor indflydelse på den nuværende tilstand (jf. Hyndman & Athanasopoulos, kap. 9).

**ETS (Exponential Smoothing State Space Model)**\
ETS-modeller benytter eksponentiel glatning til at vægte nyere observationer højere og beskriver tidsserier ud fra tre elementer: fejl, trend og sæson. Hver komponent kan være additiv eller multiplicativ afhængigt af dataens karakter. ETS egner sig godt til serier med tydelige strukturer og sæsonrytmer, især når der ikke er behov for at modellere autokorrelation direkte (jf. kap. 8).

**SNAÏVE (Seasonal Naive)**\
SNaive er en enkel benchmarkmodel, der baserer hvert forecast på den tilsvarende værdi fra samme sæson i den foregående periode. Modellen fanger sæsonmønstre, men tager ikke højde for trend eller afhængighed i data. Den anvendes til at vurdere, om mere komplekse modeller giver en mærkbart bedre forecast-præcision (jf. kap. 3 og 8).

## Modellering i praksis

Ved hjælp af fable-pakken estimeres de tre modeller automatisk for hver af de ti tidsserier på baggrund af data fra 2007 til 2019. Herefter genereres forecasts for 2020 med tilhørende prædiktionsintervaller. Prognoserne visualiseres, så man kan sammenligne modellernes adfærd på tværs af regioner og køn.

```{r tabel 2}
#| echo: false
#| warning: false
#| message: false

# Estimér modeller for hele perioden 2007–2019
models <- data |> 
  model(
    ARIMA  = ARIMA(svalue),
    ETS    = ETS(svalue),
    SNaive = SNAIVE(svalue)
  )

# Udtræk modelinformation med glance()
# Brug TIDY til at få modelstruktur
modelinfo <- models |>
  glance() |>
  select(kon, region, .model, AICc)


# Vis tabellen
modelinfo |> 
  arrange(kon, region) |> 
  kable(format = "markdown",
        caption = "Tabel 2: Automatisk valgte modelstrukturer for hver serie (region × køn)",
        align = "l") |> 
  kable_styling(full_width = FALSE, position = "center", bootstrap_options = c("striped", "hover")) |> 
  row_spec(0, bold = TRUE, background = "#f0f0f0")


```

Modelvalget er gennemført for hver enkelt tidsserie ved automatisk estimering af ARIMA-, ETS- og SNaive-modeller med fable-pakken. Udvælgelsen er sket på baggrund af AICc, som sikrer en afbalanceret vurdering af modelkompleksitet og tilpasningsevne – særligt vigtigt for relativt korte tidsserier. Resultaterne i Tabel 2 viser, at modellerne varierer betydeligt på tværs af køn og regioner, hvilket understreger nødvendigheden af en differentieret strategi, hvor hver tidsserie behandles individuelt.

SNaive-modellen er anvendt som benchmark og danner referencepunkt for den efterfølgende evaluering. Den egentlige vurdering af modellernes forecast-præcision foretages først i næste afsnit, hvor modellerne sammenlignes på baggrund af tidsserie-krydsvalidering og metrikker som RMSE og MAPE.

# Modelvalidering

For at opnå en robust vurdering kombineres testsplit og time series cross-validation. Testsplittet simulerer en realistisk forecast-situation, mens cross-validation måler præcisionen over flere tidspunkter og reducerer risikoen for tilfældige variationer.

## Trænings- og testsplit

Datasættet opdeles i en træningsperiode (2007–2018) og en testperiode (2019). Modellerne estimeres på træningsdata og genererer forecasts for teståret. Præcisionen vurderes ved sammenligning med de faktiske observationer fra 2019.

```{r}
#| echo: false
#| warning: false
#| message: false

# Opdel datasættet i træning og test

train_data <- data |> filter_index(. ~ "2018 Dec")
test_data  <- data |> filter_index("2019 Jan" ~ "2019 Dec")

# Estimér modeller for træningsdata
model_train <- train_data |> 
  model(
    ARIMA  = ARIMA(svalue),
    ETS    = ETS(svalue),
    SNaive = SNAIVE(svalue)
  )

# Forecast for 12 måneder (mod testdata)
forecast_2019 <- model_train |> forecast(h = "12 months")

```

## Evalueringsmetrikker: RMSE og MAPE

For at vurdere, hvor godt modellerne forudsiger arbejdsløsheden, sammenlignes deres forecasts for 2019 med de faktiske observationer. Der anvendes to metrikker:

-   RMSE måler den gennemsnitlige afvigelse og lægger vægt på store fejl.

-   MAPE viser den gennemsnitlige procentvise fejl og muliggør sammenligning på tværs af serier med forskellig måleenhed.

Tabellen nedenfor viser RMSE og MAPE for alle modeller og serier. Værdierne bruges som grundlag for at vurdere, hvilke modeller der præsterer bedst.

```{r}
#| echo: false
#| warning: false
#| message: false

# Udregn RMSE og MAPE pr. model og serie
forecast_2019 |> 
  accuracy(test_data) |> 
  select(kon, region, .model, RMSE, MAPE) |> 
  arrange(region, kon, RMSE)

```

## Valg af bedste model pr. serie

For hver kombination af region og køn vælges den model, der opnår lavest RMSE i testperioden. Dette valg sikrer, at den videre analyse baseres på modeller med høj prædiktiv nøjagtighed.

```{r}
#| echo: false
#| warning: false
#| message: false

# Vælg modellen med lavest RMSE pr. tidsserie
forecast_2019 |> 
  accuracy(test_data) |> 
  group_by(kon, region) |> 
  slice_min(RMSE, n = 1) |> 
  ungroup() |> 
  select(kon, region, .model, RMSE, MAPE)
```

Som det fremgår af tabellen, vælges ARIMA-modellen for samtlige serier for kvinder. For mænd er billedet mere varieret: ARIMA vinder i Nordjylland og Sjælland, mens SNaive udgør bedste model i de øvrige regioner. Det viser, at præcisionen afhænger både af den regionale kontekst og datamønstre knyttet til køn.

## Visualisering af forecast vs. faktiske værdier

Forecast og faktisk udvikling kan visualiseres for alle 10 tidsserier:

```{r}
#| echo: false
#| warning: false
#| message: false

labels <- forecast_2019 |> 
  accuracy(test_data) |> 
  group_by(kon, region) |> 
  slice_min(RMSE, n = 1) |> 
  ungroup() |> 
  mutate(label = paste0("Bedste: ", .model))

forecast_2019 |> 
  autoplot(test_data, level = NULL) +
  facet_grid(region ~ kon, scales = "free_y") +
  geom_text(data = labels, 
            aes(x = as.Date("2019-01-01"), y = Inf, label = label),
            inherit.aes = FALSE,
            vjust = 1.5, hjust = 0,
            size = 3.5, fontface = "italic") +
  labs(
    title = "Forecast-præcision i testperioden (2019)",
    subtitle = "Sammenligning af modeller – med vinder pr. serie",
    y = "Arbejdsløse pr. 10.000 personer", x = "Tid"
  ) +
  coord_cartesian(xlim = c(as.Date("2019-01-01"), as.Date("2019-12-31"))) +
  theme_minimal() +
  theme(legend.position = "bottom", legend.title = element_blank())


```

Den identificerede model med lavest forecastfejl anvendes i den videre analyse, da den vurderes mest robust til at forudsige fremtidige observationer.

## Time series cross-validation

For at supplere den traditionelle opdeling i trænings- og testperiode anvendes time series cross-validation med rullende vindue. Dette gør det muligt at evaluere forecast-præcisionen på tværs af flere tidspunkter og dermed sikre mere robust modelvurdering.

Datasættet strækkes med et startvindue på 60 måneder og forecast-horisont på 1 måned. For hver udvidet vindue estimeres modellerne (ARIMA, ETS og SNaive), og forecast-fejl beregnes.

```{r}
#| echo: false
#| warning: false
#| message: false

# Indlæs eksisterende cv_accuracy, hvis filen findes
if (file.exists("data/cv_accuracy.rds")) {
  cv_accuracy <- readRDS("data/cv_accuracy.rds")
} else {
  # Kør beregning og gem til fil, hvis den ikke allerede findes
  data_cv <- data |>
    stretch_tsibble(.init = 60, .step = 1)

  cv_models <- data_cv |> 
    model(
      ARIMA  = ARIMA(svalue),
      ETS    = ETS(svalue),
      SNaive = SNAIVE(svalue)
    )

  cv_accuracy <- cv_models |> 
    forecast(h = 1) |> 
    accuracy(data) |> 
    select(kon, region, .model, RMSE, MAPE)

  #write_rds(cv_accuracy, "data/cv_accuracy.rds")
}
```

**Gennemsnitlig performance på tværs af alle tidsserier:**

```{r}
#| echo: false
#| warning: false
#| message: false

cv_accuracy |> 
  group_by(.model) |> 
  summarise(across(c(RMSE, MAPE), mean, na.rm = TRUE)) |> 
  arrange(RMSE)

```

ARIMA opnår de laveste gennemsnitlige RMSE- og MAPE-værdier og præsterer bedst på tværs af serier.

**Den bedste model pr. serie (lavest RMSE):**

```{r}
#| echo: false
#| warning: false
#| message: false

cv_accuracy |> 
  group_by(kon, region) |> 
  slice_min(RMSE, n = 1) |> 
  ungroup()

```

Resultatet viser, at ARIMA vælges for størstedelen af serierne, hvilket bekræfter den højere præcision i forhold til benchmark og ETS-modeller.

```{r}
#| echo: false
#| warning: false
#| message: false


# Find den bedste model pr. køn og region baseret på laveste RMSE
vinder_modeller <- cv_accuracy |> 
  group_by(kon, region) |> 
  slice_min(order_by = RMSE, n = 1, with_ties = FALSE) |> 
  ungroup()

xx <- cv_accuracy |> arrange(kon, region, .model, RMSE) 

```

## Residualanalyse og hvid støj

For at undersøge, om den valgte model fanger strukturen i data tilstrækkeligt, kan residualerne fra forecastmodellen inspiceres. Figuren nedenfor ses et eksempel på residualanalyse for ARIMA-modellen estimeret på kvinder i Region Syddanmark:

```{r}
#| echo: false
#| warning: false
#| message: false

model_train |> 
  filter(kon == "Kvinder", region == "Region Syddanmark") |> 
  select(ARIMA) |> 
  gg_tsresiduals()
```

Figuren indeholder tre elementer: et residualplot over tid, et ACF-plot (autokorrelationsfunktion) og et histogram. Residualerne synes at være tilfældigt fordelt omkring nul, uden synlige systematiske mønstre. ACF-plottet viser ingen signifikant autokorrelation, og histogrammet er centreret og symmetrisk. Samlet indikerer dette, at modellen er veltilpasset og ikke efterlader systematisk information i fejlleddene. Dette mønster genfindes i de øvrige ARIMA-modeller og understøttes af de statistiske test nedenfor.

Som supplement til den visuelle inspektion anvendes Ljung-Box-testen til at undersøge, om residualerne fra modellerne er ukorrellerede – altså om de udgør hvid støj.

```{r}
#| echo: false
#| warning: false
#| message: false

model_train |> 
  select(ARIMA, ETS, SNaive) |> 
  augment() |> 
  features(.resid, ljung_box, lag = 24, dof = 0)
```

For ARIMA-modellerne er p-værdierne generelt ikke-signifikante (p \> 0.05), hvilket indikerer ukorrellerede residualer og dermed en god modeltilpasning. ETS- og SNaive-modellerne har i flere tilfælde signifikante p-værdier, hvilket tyder på resterende struktur i fejlene. Det understøtter, at ARIMA ofte er den mest velegnede modeltype i dette datasæt.

På tværs af test- og CV-resultater opnår ARIMA-modellerne den højeste præcision og opfylder modelantagelserne. De vælges derfor som grundlag for den videre forecastanalyse.

På baggrund af denne modelvalidering foretages nu forecasts for året 2020, baseret på den bedst præsterende model for hver serie.

# Forecasting

## Træning og forecast for 2020

## Prædiktionsintervaller

## Visualisering af forecasts

## Centrale prognoseværdier

# Sammenligning og fortolkning

## Sammenligning på tværs af serier

## Tendenser mellem regioner og køn

# Konklusion

\newpage

# Kildeliste

Hyndman, R. J., & Athanasopoulos, G. (2021). *Forecasting: principles and practice* (3rd ed.). OTexts. https://otexts.com/fpp3/

\newpage

# Bilagsoversigt

-   Bilag 1: Udleverede Powerpointpræsentationer v. Michael Freundlich: Chefkonsulent, Erhvervsservice og facility
